<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20001102//EN" "http://www.w3.org/TR/2000/CR-SVG-20001102/DTD/svg-20001102.dtd">
<svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" onload="Init(evt)" onmousedown="Grab(evt)" onmousemove="Drag(evt)" onmouseup="Drop(evt)">

 <title>Drag And Drop</title>

 <desc>Sliders to indicate location on a timeline
  Sarah Bell-Etkin for Heml-Fawcett, 2010
 </desc>

 <script><![CDATA[ 
  var SVGDocument = null;
  var SVGRoot = null;

  var TrueCoords = null;

  var DragTarget = null;
  var Left;
  var Right;
  var TLeft;
  var TRight;
  var Centre;
  var OldBound;
  var NowBound;
  
  var lowBound;
  var highBound;
  var pixDistance;
  var scale;
  var ratio;
  var time;
  
  var LEFT_X = 50;     // pixels
  var RIGHT_X = 1220;  // pixels

  function Init(evt){
   SVGDocument = evt.target.ownerDocument;
   SVGRoot = SVGDocument.documentElement;
   StartTimeLine(-100, 150);
  };

  function StartTimeLine(low, high){
   TrueCoords = SVGRoot.createSVGPoint();
   Left = SVGDocument.getElementById('LeftSlider');
   Right = SVGDocument.getElementById('RightSlider');
   TLeft = SVGDocument.getElementById('ChangeL');
   TRight = SVGDocument.getElementById('ChangeR');
   Centre = SVGDocument.getElementById('TextBox');
   OldBound = SVGDocument.getElementById('LBound');
   NowBound = SVGDocument.getElementById('RBound');
   
   if(low <= high){
    lowBound = low;
    highBound = high;
   }
   else{
    lowBound = high;
    highBound = low;
   }

   SetBounds();
   FindPoints();
  };

  function SetBounds(){
   ChangeOld = SVGDocument.getElementById('LeftBound');
   if(lowBound < 0){
    lower = lowBound * -1;
    newTextL = SVGDocument.createTextNode(lower + ' BCE');
   }
   else{
    newTextL = SVGDocument.createTextNode(lowBound + ' CE');
   }
   ChangeOld.replaceChild(newTextL, ChangeOld.firstChild);

   ChangeNow = SVGDocument.getElementById('RightBound');
   if(highBound < 0){
    higher = highBound * -1;
    newTextR = SVGDocument.createTextNode(higher + ' BCE');
   }
   else{
    newTextR = SVGDocument.createTextNode(highBound + ' CE');
   }
   ChangeNow.replaceChild(newTextR, ChangeNow.firstChild);
  };

  function FindPoints(){
   length = highBound - lowBound;
   temp = length / 3;
   startLeft = Math.round(lowBound + temp);
   if(startLeft < 0){
    startLeft = startLeft * -1;
    newStartL = SVGDocument.createTextNode(startLeft + ' BCE');
   }
   else{
    newStartL = SVGDocument.createTextNode(startLeft + ' CE');
   }
   TLeft.replaceChild(newStartL, TLeft.firstChild);

   startRight = Math.round(highBound - temp);
   if(startRight < 0){
    startRight = startRight * -1;
    newStartR = SVGDocument.createTextNode(startRight + ' BCE');
   }
   else{
    newStartR = SVGDocument.createTextNode(startRight + ' CE');
   }
   TRight.replaceChild(newStartR, TRight.firstChild);

   mid = length / 2;
   midPoint = Math.round(highBound - mid);
   if(midPoint == 0){
    midPoint = 1;
   }
   if(midPoint < 0){
    midPoint = midPoint * -1;
    newMid = SVGDocument.createTextNode(midPoint + ' BCE');
   }
   else{
    newMid = SVGDocument.createTextNode(midPoint + ' CE');
   }
   Centre.replaceChild(newMid, Centre.firstChild);
  };

  function Grab(evt){
   var targetElement = evt.target;
   if(targetElement == Left || targetElement == Right){
    DragTarget = targetElement;
    DragTarget.parentNode.appendChild(DragTarget); // if this is gone, behaviour is different on the 2nd drag
    DragTarget.setAttributeNS(null, 'pointer-events', 'none');
   }
  };

  function Drag(evt){
   if(DragTarget){
    newX = CheckBounds(evt.clientX);
    DragTarget.setAttributeNS(null, 'cx', newX);
    if(DragTarget == Left){
     TLeft.setAttributeNS(null, 'x', newX);
     ChangeWords(evt.clientX, 'L');
    }
    else if(DragTarget == Right){
     TRight.setAttributeNS(null, 'x', newX);
     ChangeWords(evt.clientX, 'R');
    }
   }
  };

  function Drop(evt){
   if(DragTarget){
    var targetElement = evt.target;
    DragTarget.setAttributeNS(null, 'pointer-events', 'all');
    DragTarget = null;
   }
  };

  function ChangeWords(xVal, slider){
   if(slider == 'L' || slider == 'R'){
    Changeable = SVGDocument.getElementById('Change' + slider);
   }
   newVal = Scale(xVal, slider);
   if(newVal < lowBound){	
    newVal = lowBound;
   }
   else if(newVal > highBound){
    newVal = highBound;
   }
   if(newVal < 0){
    newVal = newVal * -1;   
    newText = SVGDocument.createTextNode(newVal + ' BCE');
   }
   else{
    newText = SVGDocument.createTextNode(newVal + ' CE');
   }
   Changeable.replaceChild(newText, Changeable.firstChild);  
  };

  function Scale(x, slider){
   scale = highBound - lowBound;
   pixDistance = RIGHT_X - LEFT_X;
   ratio = (x - LEFT_X) / pixDistance;
   time = Math.round(ratio * scale) + lowBound;
   return time;
  };

  function CheckBounds(x){
   if(x <= LEFT_X){
    return LEFT_X;
   }
   else if(x >= RIGHT_X){
    return RIGHT_X;
   }
   return x;
  };

 ]]></script>

 <rect id = "BackDrop" x = "-10%" y = "-10%" width = "110%" height = "110%" fill = "none" pointer-events = "all"/>

 <g id = "Left">
  <circle id = "LeftSlider" cx="440" cy="20%" r="10" style="fill: blue;" stroke="black" stroke-width="2"/>
  <text id = "ChangeL" x = "440" y = "30%" font-family = "sans-serif" font-weight = "bold" font-size = "12pt" text-anchor = "middle">Left</text>
 </g>

 <g id = "Right">
  <circle id="RightSlider" cx="830" cy="20%" r="10" style="fill: red;" stroke="black" stroke-width="2"/>
  <text id = "ChangeR" x = "830" y = "30%" font-family = "sans-serif" font-weight = "bold" font-size = "12pt" text-anchor = "middle">Right</text>
 </g> 
 
 <g id = "LBound" style = "font-family: sans-serif; font-weight: bold; font-size: 12pt">
  <text id = "LeftBound" x = "5%" y = "60" text-anchor = "middle">Low Bound</text>
  <line id = "LPath" stroke-width = "5" stroke = "black" x1 = "50" y1 = "15%" x2 = "50" y2 = "25%"/>
 </g>

 <g id = "RBound" style = "font-family: sans-serif; font-weight: bold; font-size: 12pt"> >
  <text id = "RightBound" x = "95%" y = "60" text-anchor = "middle">Top Bound</text>
  <line id = "RPath" stroke-width = "5" stroke = "black" x1 = "1220" y1 = "15%" x2 = "1220" y2 = "25%"/>
 </g>

 <g id = "1Year" style = "font-family: sans-serif; font-weight: bold; font-size: 12pt">
  <text id = "TextBox" x = "635" y = "60" text-anchor = "middle">Centre</text>
  <line id = "MiddlePath" stroke-width = "5" stroke = "black" x1 = "635" y1 = "16%" x2 = "635" y2 = "24%"/>
 </g>

</svg>